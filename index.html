<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>QCM Culture Incendie</title>

<style>
body { font-family: Arial, sans-serif; background:#111; color:#111; margin:0 }
.bg { position:fixed; inset:0; background:url("regiolis.jpg") center/cover; z-index:-2 }
.overlay { position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:-1 }
.container { max-width:800px; margin:auto; padding:20px }
.card { background:#fff; border-radius:12px; padding:20px; margin-bottom:15px }
button { padding:12px; width:100%; font-weight:bold }
.hidden { display:none }
</style>
</head>

<body>
<div class="bg"></div>
<div class="overlay"></div>

<div class="container">

<h1 style="color:white;text-align:center">QCM Culture Incendie</h1>

<div id="startCard" class="card">
  <label>Service (obligatoire)</label>
  <select id="serviceOrigin">
    <option value="">â€” choisir â€”</option>
    <option>Escale</option>
    <option>ASCT</option>
    <option>Maintenance</option>
  </select>

  <label>Nom</label>
  <input id="lastName" type="text">

  <label>PrÃ©nom</label>
  <input id="firstName" type="text">

  <button id="startBtn">DÃ©marrer le diagnostic</button>
  <p id="warn" style="color:red;display:none">Tous les champs sont obligatoires</p>
</div>

<div id="quizCard" class="card hidden">
  <h2 id="questionText"></h2>
  <div id="options"></div>
  <button id="nextBtn" disabled>Suivant</button>
</div>

<div id="finalCard" class="card hidden">
  <h2>TerminÃ©</h2>
  <textarea id="freeText" placeholder="Commentaire (optionnel)"></textarea>
  <button id="sendBtn">Envoyer</button>
</div>

<div id="doneCard" class="card hidden">
  <h2>âœ… RÃ©sultats envoyÃ©s</h2>
</div>

</div>

<script>
// ðŸ”— URL GOOGLE SCRIPT
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx0kqt1t0nhy3DVU6iJ4vQT4vDLfv_Gz7Jdoha3Ydx-FZdK8KAhdmQa73A3_VTMPt6xKA/exec";

// âœ… QUESTIONS VALIDES (EXEMPLE)
const QUESTIONS = [
  {
    text: "La prioritÃ© en cas d'incendie est :",
    options: [
      "Sauver le matÃ©riel",
      "Ã‰teindre le feu",
      "La sÃ©curitÃ© des personnes",
      "Limiter les retards"
    ],
    correctIndex: 2
  },
  {
    text: "En prÃ©sence de fumÃ©es, lâ€™agent doit :",
    options: [
      "Sâ€™approcher",
      "Ventiler",
      "Ne pas sâ€™exposer et alerter",
      "Ouvrir les portes"
    ],
    correctIndex: 2
  }
];

// --- LOGIQUE ---
const $ = id => document.getElementById(id);
let index = 0;
let answers = [];
let resp = {};

$("startBtn").onclick = () => {
  if (!$("serviceOrigin").value || !$("lastName").value || !$("firstName").value) {
    $("warn").style.display = "block";
    return;
  }
  resp.service = $("serviceOrigin").value;
  resp.nom = $("lastName").value + " " + $("firstName").value;
  $("startCard").classList.add("hidden");
  $("quizCard").classList.remove("hidden");
  renderQuestion();
};

function renderQuestion() {
  const q = QUESTIONS[index];
  $("questionText").textContent = q.text;
  $("options").innerHTML = "";
  q.options.forEach((opt, i) => {
    const lbl = document.createElement("label");
    lbl.innerHTML = `<input type="radio" name="opt" value="${i}"> ${opt}`;
    $("options").appendChild(lbl);
  });
  $("nextBtn").disabled = true;
  $("options").onchange = () => $("nextBtn").disabled = false;
}

$("nextBtn").onclick = () => {
  const sel = document.querySelector("input[name='opt']:checked");
  answers.push(sel ? Number(sel.value) : null);
  index++;
  if (index >= QUESTIONS.length) {
    $("quizCard").classList.add("hidden");
    $("finalCard").classList.remove("hidden");
  } else {
    renderQuestion();
  }
};

// ðŸ”¥ ENVOI SANS ATTENTE (SNCF OK)
$("sendBtn").onclick = () => {
  const payload = {
    date: new Date().toISOString(),
    service: resp.service,
    nom: resp.nom,
    reponses: answers,
    commentaire: $("freeText").value
  };

  try {
    fetch(APPS_SCRIPT_URL, {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify(payload)
    });
  } catch (e) {}

  $("finalCard").classList.add("hidden");
  $("doneCard").classList.remove("hidden");
};
</script>
</body>
</html>
