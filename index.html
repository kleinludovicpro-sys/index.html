<!doctype html>
<html lang="fr">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>QCM Culture Incendie - Diagnostic</title>

Â  <style>
Â  Â  :root {Â 
Â  Â  Â  --card-bg: rgba(255,255,255,0.72);Â 
Â  Â  Â  --accent: #111;
Â  Â  Â  --sncf-blue: #0088ce;
Â  Â  Â  --border: rgba(0,0,0,0.1);
Â  Â  }
Â  Â  * { box-sizing: border-box; }
Â  Â  body {
Â  Â  Â  font-family: system-ui, -apple-system, sans-serif;
Â  Â  Â  margin: 0; min-height: 100vh; color: #111; background: #0f1115;
Â  Â  }
Â  Â  .bg {
Â  Â  Â  position: fixed; inset: 0;
Â  Â  Â  background-image: url("regiolis.jpg");
Â  Â  Â  background-size: cover; background-position: center;
Â  Â  Â  z-index: -3; pointer-events: none;
Â  Â  }
Â  Â  .overlay {
Â  Â  Â  position: fixed; inset: 0;
Â  Â  Â  background: linear-gradient(180deg, rgba(0,0,0,0.7), rgba(0,0,0,0.5));
Â  Â  Â  z-index: -2; pointer-events: none;
Â  Â  }
Â  Â  .container { max-width: 800px; margin: 0 auto; padding: 20px 15px; position: relative; z-index: 1; }
Â  Â  h1 { color: #fff; font-size: 1.6rem; text-align: center; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
Â  Â  .muted { color: rgba(255,255,255,0.9); text-align: center; font-size: 0.9rem; margin-bottom: 20px; }
Â  Â  .card { background: var(--card-bg); border-radius: 16px; padding: 20px; margin-bottom: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
Â  Â  label { font-weight: 700; display: block; margin-bottom: 5px; margin-top: 10px; }
Â  Â  input[type="text"], select, textarea { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border); font-size: 1rem; margin-bottom: 10px; }
Â  Â  button { width: 100%; padding: 14px; border-radius: 10px; border: none; background: var(--accent); color: #fff; font-weight: 700; font-size: 1rem; cursor: pointer; margin-top: 10px; }
Â  Â  button:disabled { opacity: 0.4; cursor: not-allowed; }
Â  Â  button.secondary { background: #fff; color: #111; border: 1px solid #ccc; }
Â  Â  .pill { background: #eee; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 700; }
Â  Â  progress { width: 100%; height: 10px; margin: 15px 0; border-radius: 5px; }
Â  Â  #questionText { font-size: 1.25rem; font-weight: 800; line-height: 1.3; margin: 15px 0; }
Â  Â  .options label { display: flex; align-items: center; padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 10px; cursor: pointer; transition: background 0.2s; }
Â  Â  .options label:hover { background: #f9f9f9; }
Â  Â  .options input { transform: scale(1.3); margin-right: 12px; }
Â  Â  .danger { color: #d32f2f; font-weight: 700; }
Â  Â  .ok { color: #2e7d32; font-weight: 700; text-align: center; }
Â  </style>
</head>

<body>
Â  <div class="bg"></div>
Â  <div class="overlay"></div>

Â  <div class="container">
Â  Â  <h1>QCM Culture Incendie</h1>
Â  Â  <p class="muted"><span id="totalQTop">30</span> questions â€¢ 15 secondes par question</p>

Â  Â  <div id="startCard" class="card">
Â  Â  Â  <label>Service dâ€™origine (obligatoire)</label>
Â  Â  Â  <select id="serviceOrigin">
Â  Â  Â  Â  <option value="">â€” SÃ©lectionner â€”</option>
Â  Â  Â  Â  <option value="Escale">Escale</option>
Â  Â  Â  Â  <option value="Vente / Accueil">Vente / Accueil</option>
Â  Â  Â  Â  <option value="ASCT">ASCT</option>
Â  Â  Â  Â  <option value="Conducteur">Conducteur</option>
Â  Â  Â  Â  <option value="SÃ»retÃ©">SÃ»retÃ©</option>
Â  Â  Â  Â  <option value="Maintenance / Technique">Maintenance / Technique</option>
Â  Â  Â  Â  <option value="Gares & Connexions">Gares & Connexions</option>
Â  Â  Â  Â  <option value="Autre">Autre</option>
Â  Â  Â  </select>

Â  Â  Â  <div id="otherServiceWrap" style="display:none;">
Â  Â  Â  Â  <input id="serviceOther" type="text" placeholder="PrÃ©cisez votre service" />
Â  Â  Â  </div>

Â  Â  Â  <label>Nom (obligatoire)</label>
Â  Â  Â  <input id="lastName" type="text" placeholder="Nom" />

Â  Â  Â  <label>PrÃ©nom (obligatoire)</label>
Â  Â  Â  <input id="firstName" type="text" placeholder="PrÃ©nom" />

Â  Â  Â  <button id="startBtn">DÃ©marrer le diagnostic</button>
Â  Â  Â  <p id="startWarn" class="danger" style="display:none; text-align:center;">
Â  Â  Â  Â  Service + Nom + PrÃ©nom obligatoires.
Â  Â  Â  </p>
Â  Â  </div>

Â  Â  <div id="quizCard" class="card" style="display:none;">
Â  Â  Â  <div style="display:flex; justify-content: space-between;">
Â  Â  Â  Â  <span class="pill">Q <span id="qIndex">1</span>/<span id="totalQ">30</span></span>
Â  Â  Â  Â  <span class="pill">Chrono: <span id="timeLeft">15</span>s</span>
Â  Â  Â  </div>
Â  Â  Â  <progress id="progress" value="0" max="15"></progress>
Â  Â  Â  <div id="questionText">...</div>
Â  Â  Â  <div id="options" class="options"></div>
Â  Â  Â  <button id="nextBtn" disabled>Valider & Suivant</button>
Â  Â  Â  <button id="skipBtn" class="secondary">Passer</button>
Â  Â  </div>

Â  Â  <div id="finalCard" class="card" style="display:none;">
Â  Â  Â  <h2 style="margin-top:0;">Diagnostic terminÃ©</h2>
Â  Â  Â  <label>Un retour Ã  nous faire ? (optionnel)</label>
Â  Â  Â  <textarea id="freeText" placeholder="DifficultÃ©s rencontrÃ©es, points flous..."></textarea>
Â  Â  Â  <button id="sendBtn">Envoyer mes rÃ©sultats</button>
Â  Â  Â  <p id="sendStatus" style="text-align:center; font-weight:bold;"></p>
Â  Â  </div>

Â  Â  <div id="doneCard" class="card" style="display:none;">
Â  Â  Â  <h2 class="ok">âœ… RÃ©sultats envoyÃ©s</h2>
Â  Â  Â  <p style="text-align:center;">Merci pour votre participation.</p>
Â  Â  </div>
Â  </div>

<script>
Â  // CONFIGURATION
Â  const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx0kqt1t0nhy3DVU6iJ4vQT4vDLfv_Gz7Jdoha3Ydx-FZdK8KAhdmQa73A3_VTMPt6xKA/exec";
Â  const TIME_LIMIT = 15;

Â  // QUESTIONS
Â  const QUESTIONS = [
Â  Â  { id:"Q1", text:"Quels sont les trois Ã©lÃ©ments constituant le \"Triangle du feu\" indispensables au dÃ©clenchement d'une combustion ?", options:["OxygÃ¨ne, Chaleur, Ã‰tincelle","Combustible, Comburant, Source d'inflammation","Bois, Essence, Ã‰lectricitÃ©","Gaz, Flamme, FumÃ©e"], correctIndex:1 },
Â  Â  { id:"Q2", text:"Quelle est la premiÃ¨re cause de dÃ©cÃ¨s lors d'un incendie en milieu professionnel ?", options:["Les brÃ»lures graves par contact direct avec les flammes","L'effondrement prÃ©coce des structures du bÃ¢timent","L'inhalation des fumÃ©es et des gaz toxiques","Les traumatismes liÃ©s aux mouvements de panique"], correctIndex:2 },
Â  Â  { id:"Q3", text:"Quel gaz inodore et indÃ©celable constitue le toxique majeur produit lors de toute combustion ?", options:["Le Dioxyde de carbone (CO2)","Le Monoxyde de carbone (CO)","Le Cyanure d'hydrogÃ¨ne (HCN)","Le Dioxyde d'azote (NO2)"], correctIndex:1 },
Â  Â  { id:"Q4", text:"Pour un feu de Classe A (bois, carton, papier), quel agent extincteur est prÃ©conisÃ© par les consignes de sÃ©curitÃ© ?", options:["Eau pulvÃ©risÃ©e (avec ou sans additif)","Dioxyde de carbone (CO2) exclusivement","Poudre BC","Sable sec"], correctIndex:0 },
Â  Â  { id:"Q5", text:"Quel mode de propagation correspond au transfert de chaleur par mouvement d'air chaud et de fumÃ©es vers les parties hautes ?", options:["La conduction","Le rayonnement","La convection","Le dÃ©placement de substances"], correctIndex:2 },
Â  Â  { id:"Q6", text:"Quelle est l'action prioritaire sur le terminal Siemens dÃ¨s le dÃ©clenchement d'une alarme feu ?", options:["Appeler immÃ©diatement les secours extÃ©rieurs","Appuyer sur la touche <ArrÃªt signal sonore>","RÃ©armer directement la centrale","Ouvrir le menu \"Topologie\""], correctIndex:1 },
Â  Â  { id:"Q7", text:"Sur le terminal, si aprÃ¨s avoir appuyÃ© sur \"Plus Options\" l'option << Afficher consigne >> n'apparaÃ®t pas, que faut-il faire ?", options:["Appuyer sur la touche \"R\" pour forcer l'affichage","Saisir immÃ©diatement le code d'accÃ¨s 2222","Appuyer sur la touche << C >> pour revenir Ã  la localisation","Ã‰teindre et rallumer le terminal"], correctIndex:2 },
Â  Â  { id:"Q8", text:"Quel est le risque majeur mentionnÃ© lors d'une mise \"Hors service\" (ZDA ou dÃ©tecteur) ?", options:["Le dÃ©clenchement d'une alarme de dÃ©rangement permanente","L'impossibilitÃ© de rÃ©armer le SMSI","Le feu peut s'Ã©tendre sans obstacle car les alarmes ne sont plus acquises","La perte dÃ©finitive de la configuration logicielle"], correctIndex:2 },
Â  Â  { id:"Q9", text:"Dans le cas d'un \"Incident mineur\", quelle est la sÃ©quence exacte pour valider l'opÃ©ration au terminal ?", options:["Appuyer sur \"RÃ©armement\" puis \"C\"","Appuyer sur \"OK\" puis saisir le code 2222","Entrer le mot de passe \"xxxx\" puis appuyer sur \"OK\"","Maintenir la touche \"Plus Options\" pendant 5 secondes"], correctIndex:2 },
Â  Â  { id:"Q10", text:"Quel risque spÃ©cifique prÃ©sente une batterie au plomb (prÃ©sente dans les ECS/SMSI) en cas d'incendie dans son local ?", options:["Aucun, le plomb est un mÃ©tal incombustible","Ã‰mission d'hydrogÃ¨ne explosif et projection d'acide sulfurique corrosif","Transformation immÃ©diate du plomb en gaz toxique asphyxiant","Risque d'implosion par vide d'air"], correctIndex:1 },
Â  Â  { id:"Q11", text:"Que signifie l'acronyme SDI dans le cadre du SystÃ¨me de SÃ©curitÃ© Incendie ?", options:["SystÃ¨me de Distribution d'Incendie","SystÃ¨me de DÃ©tection Incendie","Signal de Danger Imminent","SÃ©curitÃ© des DÃ©tecteurs Individuels"], correctIndex:1 },
Â  Â  { id:"Q12", text:"Ã€ la Gare de Bayonne, quel code est affichÃ© sur le terminal pour accÃ©der aux fonctions de niveau 2 (SDI) ?", options:["1234","2222","0000","ABCD"], correctIndex:1 },
Â  Â  { id:"Q13", text:"Dans quelle zone gÃ©ographique de la gare se situe la ZDA 1 ?", options:["Le 1er Ã©tage (locaux tÃ©lÃ©phonie)","Le Rez-de-chaussÃ©e (espace de vente)","Le Sous-sol (local TGBT)","La Tour de l'horloge"], correctIndex:2 },
Â  Â  { id:"Q14", text:"Quelle est la manipulation correcte pour rÃ©armer un DÃ©clencheur Manuel (DM) aprÃ¨s une alarme ?", options:["Saisir le code 2222 sur le boÃ®tier rouge","Introduire la clÃ© noire sous le boÃ®tier et la pousser vers le haut","Remplacer la membrane dÃ©formable par une neuve","Appuyer 3 fois sur le bouton central"], correctIndex:1 },
Â  Â  { id:"Q15", text:"Quelle est la mission principale du SMSI (SystÃ¨me de Mise en SÃ©curitÃ© Incendie) ?", options:["Alerter les pompiers par transmetteur","Traiter et effectuer les mises en sÃ©curitÃ© (compartimentage, dÃ©senfumage)","Ã‰teindre automatiquement le dÃ©but d'incendie","Identifier prÃ©cisÃ©ment le numÃ©ro du dÃ©tecteur en alarme"], correctIndex:1 },
Â  Â  { id:"Q16", text:"Quelle prÃ©caution physique est impÃ©rative avant d'ouvrir la porte d'un local en alarme ?", options:["Frapper fort pour avertir d'Ã©ventuels occupants","Ã‰valuer la tempÃ©rature de la porte avec le dos de la main sans la toucher directement si elle semble brÃ»lante","Regarder par le trou de la serrure pour voir les flammes","Ouvrir la porte d'un coup sec pour Ã©vacuer la fumÃ©e"], correctIndex:1 },
Â  Â  { id:"Q17", text:"Ã€ quel phÃ©nomÃ¨ne thermique mortel s'expose un agent qui ouvre une porte de local en feu sans prÃ©caution ?", options:["Une simple remontÃ©e de poussiÃ¨res","Une explosion de fumÃ©es (Backdraft) ou un embrasement gÃ©nÃ©ralisÃ© Ã©clair (Flashover)","Un gel immÃ©diat dÃ» Ã  la chute de pression","Une dÃ©charge Ã©lectrostatique de la structure"], correctIndex:1 },
Â  Â  { id:"Q18", text:"En quoi la responsabilitÃ© pÃ©nale de l'agent peut-elle Ãªtre engagÃ©e lors de la levÃ©e de doute ?", options:["Uniquement en cas de vol de matÃ©riel durant l'intervention","Uniquement si l'agent est le chef d'Ã©tablissement dÃ©clarÃ©","Pour \"mise en danger dÃ©libÃ©rÃ©e d'autrui\" ou \"homicide involontaire\" en cas de non-respect des consignes de sÃ©curitÃ© ayant entraÃ®nÃ© des victimes","Sa responsabilitÃ© est nulle car il agit sous les ordres de sa hiÃ©rarchie"], correctIndex:2 },
Â  Â  { id:"Q19", text:"Pourquoi l'inhalation de fumÃ©e, mÃªme sur une courte durÃ©e, est-elle extrÃªmement dangereuse pour l'agent ?", options:["Elle provoque simplement une toux passagÃ¨re irritante","L'opacitÃ© empÃªche toute orientation et les gaz (CO/HCN) provoquent une perte de connaissance en quelques inspirations","Elle rend les vÃªtements inflammables par dÃ©pÃ´t de suie","Elle dÃ©truit instantanÃ©ment l'Ã©mail des dents"], correctIndex:1 },
Â  Â  { id:"Q20", text:"Quelle est la conduite Ã  tenir si la levÃ©e de doute confirme un feu non maÃ®trisable ?", options:["Essayer de vider tous les extincteurs de l'Ã©tage","Aviser immÃ©diatement les secours (18 ou 112) et Ã©vacuer la gare","Attendre l'arrivÃ©e du chef de gare pour dÃ©cider","Prendre des photos pour le rapport d'incident avant de partir"], correctIndex:1 },
Â  ];

Â  const $ = (id) => document.getElementById(id);
Â  let idx = 0, timer = null, timeLeft = TIME_LIMIT;
Â  const answers = [];
Â  const resp = { service:"", last:"", first:"" };

Â  // === FLAMMES RÃ‰ALISTES (canvas) â€” Ã§a pÃ¨te ===
Â  function launchFlames(durationMs = 2600, intensity = 2.0) {
Â  Â  const existing = document.getElementById("flameCanvas");
Â  Â  if (existing) existing.remove();

Â  Â  const canvas = document.createElement("canvas");
Â  Â  canvas.id = "flameCanvas";
Â  Â  canvas.style.position = "fixed";
Â  Â  canvas.style.inset = "0";
Â  Â  canvas.style.pointerEvents = "none";
Â  Â  canvas.style.zIndex = "9999";
Â  Â  document.body.appendChild(canvas);

Â  Â  const ctx = canvas.getContext("2d");
Â  Â  const dpr = Math.max(1, window.devicePixelRatio || 1);

Â  Â  function resize() {
Â  Â  Â  canvas.width = Math.floor(window.innerWidth * dpr);
Â  Â  Â  canvas.height = Math.floor(window.innerHeight * dpr);
Â  Â  Â  canvas.style.width = window.innerWidth + "px";
Â  Â  Â  canvas.style.height = window.innerHeight + "px";
Â  Â  Â  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
Â  Â  }
Â  Â  resize();
Â  Â  window.addEventListener("resize", resize);

Â  Â  const particles = [];
Â  Â  const sparks = [];

Â  Â  const W = () => window.innerWidth;
Â  Â  const H = () => window.innerHeight;
Â  Â  const baseX = () => W() * 0.5;
Â  Â  const baseY = () => H() + 30;

Â  Â  const rand = (a, b) => a + Math.random() * (b - a);
Â  Â  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));

Â  Â  const flameRate = Math.floor(220 * intensity);
Â  Â  const sparkRate = Math.floor(90 * intensity);
Â  Â  const jetWidthÂ  = 210 * Math.sqrt(intensity);
Â  Â  const jetHeight = 1.0 + 0.45 * intensity;
Â  Â  const shakeMaxÂ  = 4.5 * clamp(intensity, 1, 2.4);

Â  Â  let tNoise = 0;
Â  Â  function noise(x) {
Â  Â  Â  return Math.sin(x) * 0.6 + Math.sin(x * 0.37 + 1.7) * 0.3 + Math.sin(x * 0.11 + 2.9) * 0.1;
Â  Â  }

Â  Â  function addFlameParticle(burst = false) {
Â  Â  Â  particles.push({
Â  Â  Â  Â  x: baseX() + rand(-jetWidth, jetWidth) * (burst ? 1.35 : 1.0),
Â  Â  Â  Â  y: baseY(),
Â  Â  Â  Â  vx: rand(-1.7, 1.7) * (burst ? 1.7 : 1.0),
Â  Â  Â  Â  vy: -rand(3.6, 8.6) * jetHeight * (burst ? 1.25 : 1.0),
Â  Â  Â  Â  size: rand(12, 34) * (burst ? 1.2 : 1.0) * (0.95 + intensity * 0.25),
Â  Â  Â  Â  life: rand(650, 1150) / (0.85 + intensity * 0.12),
Â  Â  Â  Â  born: performance.now(),
Â  Â  Â  Â  heat: burst ? rand(0.7, 1.0) : rand(0.45, 0.95),
Â  Â  Â  Â  swirl: rand(0.7, 1.8) * (burst ? 1.25 : 1.0),
Â  Â  Â  Â  seed: Math.random() * 1000,
Â  Â  Â  });
Â  Â  }

Â  Â  function addSpark(burst = false) {
Â  Â  Â  sparks.push({
Â  Â  Â  Â  x: baseX() + rand(-jetWidth * 0.55, jetWidth * 0.55),
Â  Â  Â  Â  y: baseY() - rand(10, 110),
Â  Â  Â  Â  vx: rand(-3.0, 3.0) * (burst ? 2.0 : 1.0),
Â  Â  Â  Â  vy: -rand(6, 13) * (burst ? 1.45 : 1.0),
Â  Â  Â  Â  g: rand(0.08, 0.16),
Â  Â  Â  Â  size: rand(1.2, 3.2) * (burst ? 1.3 : 1.0),
Â  Â  Â  Â  life: rand(420, 980) / (0.9 + intensity * 0.2),
Â  Â  Â  Â  born: performance.now(),
Â  Â  Â  });
Â  Â  }

Â  Â  function burst(power = 1.0) {
Â  Â  Â  const nf = Math.floor(140 * intensity * power);
Â  Â  Â  const ns = Math.floor(110 * intensity * power);
Â  Â  Â  for (let i = 0; i < nf; i++) addFlameParticle(true);
Â  Â  Â  for (let i = 0; i < ns; i++) addSpark(true);
Â  Â  }

Â  Â  burst(1.0);

Â  Â  const start = performance.now();
Â  Â  let last = start;
Â  Â  let rafId;

Â  Â  function draw(now) {
Â  Â  Â  const elapsed = now - start;
Â  Â  Â  const dt = Math.min(40, now - last);
Â  Â  Â  last = now;

Â  Â  Â  if (elapsed < durationMs) {
Â  Â  Â  Â  const f = Math.floor((flameRate * dt) / 1000);
Â  Â  Â  Â  const s = Math.floor((sparkRate * dt) / 1000);
Â  Â  Â  Â  for (let i = 0; i < f; i++) addFlameParticle(false);
Â  Â  Â  Â  for (let i = 0; i < s; i++) addSpark(false);

Â  Â  Â  Â  if (Math.random() < 0.16 * intensity) burst(0.35);
Â  Â  Â  }

Â  Â  Â  ctx.clearRect(0, 0, W(), H());

Â  Â  Â  const shake = (elapsed < durationMs) ? (Math.random() * 2 - 1) * shakeMax * 0.28 : 0;
Â  Â  Â  const shakeY = (elapsed < durationMs) ? (Math.random() * 2 - 1) * shakeMax * 0.18 : 0;

Â  Â  Â  ctx.save();
Â  Â  Â  ctx.translate(shake, shakeY);
Â  Â  Â  ctx.globalCompositeOperation = "lighter";
Â  Â  Â  ctx.filter = "blur(12px)";
Â  Â  Â  ctx.globalAlpha = 0.22 * clamp(intensity, 1, 2.4);
Â  Â  Â  const glow = ctx.createRadialGradient(baseX(), H(), 20, baseX(), H(), 320 * intensity);
Â  Â  Â  glow.addColorStop(0.0, "rgba(255,190,60,0.95)");
Â  Â  Â  glow.addColorStop(0.35, "rgba(255,90,0,0.55)");
Â  Â  Â  glow.addColorStop(1.0, "rgba(255,30,0,0)");
Â  Â  Â  ctx.fillStyle = glow;
Â  Â  Â  ctx.beginPath();
Â  Â  Â  ctx.arc(baseX(), H(), 300 * intensity, 0, Math.PI * 2);
Â  Â  Â  ctx.fill();
Â  Â  Â  ctx.restore();

Â  Â  Â  tNoise += dt * 0.004;

Â  Â  Â  ctx.save();
Â  Â  Â  ctx.translate(shake, shakeY);
Â  Â  Â  ctx.globalCompositeOperation = "lighter";

Â  Â  Â  for (let i = particles.length - 1; i >= 0; i--) {
Â  Â  Â  Â  const p = particles[i];
Â  Â  Â  Â  const age = now - p.born;
Â  Â  Â  Â  const t = age / p.life;

Â  Â  Â  Â  if (t >= 1 || p.y < -140) {
Â  Â  Â  Â  Â  particles.splice(i, 1);
Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  }

Â  Â  Â  Â  const n = noise(tNoise + p.seed + p.y * 0.01);
Â  Â  Â  Â  const sway = n * 2.0 * p.swirl * (1.2 - t);
Â  Â  Â  Â  p.vx += sway * 0.02;

Â  Â  Â  Â  p.x += p.vx;
Â  Â  Â  Â  p.y += p.vy;
Â  Â  Â  Â  p.vy *= 0.992;
Â  Â  Â  Â  p.vx *= 0.985;

Â  Â  Â  Â  const size = p.size * (1.08 - t * 0.58);
Â  Â  Â  Â  const alpha = clamp(1.0 - t, 0, 1);
Â  Â  Â  Â  const heat = clamp(p.heat + (0.18 - t * 0.42), 0, 1);

Â  Â  Â  Â  const r = 255;
Â  Â  Â  Â  const g = Math.floor(80 + 170 * heat);
Â  Â  Â  Â  const b = Math.floor(10 + 30 * heat);

Â  Â  Â  Â  ctx.save();
Â  Â  Â  Â  ctx.globalAlpha = alpha * (0.55 + intensity * 0.15);

Â  Â  Â  Â  ctx.filter = `blur(${10 + 12 * heat}px)`;
Â  Â  Â  Â  const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, size);
Â  Â  Â  Â  grad.addColorStop(0.0, `rgba(${r},${g},${b},0.95)`);
Â  Â  Â  Â  grad.addColorStop(0.35, `rgba(255,120,0,0.65)`);
Â  Â  Â  Â  grad.addColorStop(1.0, `rgba(120,0,0,0)`);
Â  Â  Â  Â  ctx.fillStyle = grad;
Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  ctx.ellipse(p.x, p.y, size * 0.6, size * 1.1, 0, 0, Math.PI * 2);
Â  Â  Â  Â  ctx.fill();

Â  Â  Â  Â  ctx.filter = `blur(${3 + 5 * heat}px)`;
Â  Â  Â  Â  ctx.fillStyle = `rgba(255,${Math.floor(70 + 170 * heat)},0,0.55)`;
Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  ctx.ellipse(p.x, p.y + size * 0.12, size * 0.22, size * 0.6, 0, 0, Math.PI * 2);
Â  Â  Â  Â  ctx.fill();

Â  Â  Â  Â  ctx.restore();
Â  Â  Â  }

Â  Â  Â  ctx.filter = "none";
Â  Â  Â  for (let i = sparks.length - 1; i >= 0; i--) {
Â  Â  Â  Â  const s = sparks[i];
Â  Â  Â  Â  const age = now - s.born;
Â  Â  Â  Â  const t = age / s.life;

Â  Â  Â  Â  if (t >= 1 || s.y < -140) {
Â  Â  Â  Â  Â  sparks.splice(i, 1);
Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  }

Â  Â  Â  Â  s.x += s.vx;
Â  Â  Â  Â  s.y += s.vy;
Â  Â  Â  Â  s.vy += s.g;
Â  Â  Â  Â  s.vx *= 0.992;

Â  Â  Â  Â  const a = 1 - t;

Â  Â  Â  Â  ctx.save();
Â  Â  Â  Â  ctx.globalAlpha = a * 0.95;

Â  Â  Â  Â  ctx.strokeStyle = `rgba(255,220,120,${a})`;
Â  Â  Â  Â  ctx.lineWidth = 1.3;
Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  ctx.moveTo(s.x, s.y);
Â  Â  Â  Â  ctx.lineTo(s.x - s.vx * 2.0, s.y - s.vy * 2.0);
Â  Â  Â  Â  ctx.stroke();

Â  Â  Â  Â  ctx.fillStyle = `rgba(255,245,180,${a})`;
Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
Â  Â  Â  Â  ctx.fill();

Â  Â  Â  Â  ctx.restore();
Â  Â  Â  }

Â  Â  Â  ctx.restore();

Â  Â  Â  if (elapsed < durationMs || particles.length > 0 || sparks.length > 0) {
Â  Â  Â  Â  rafId = requestAnimationFrame(draw);
Â  Â  Â  } else {
Â  Â  Â  Â  cancelAnimationFrame(rafId);
Â  Â  Â  Â  window.removeEventListener("resize", resize);
Â  Â  Â  Â  canvas.remove();
Â  Â  }
Â  Â  }

Â  Â  requestAnimationFrame(draw);
Â  }

Â  // Affichage du total (Ã©vite le bug "30" si la liste change)
Â  $("totalQ").textContent = QUESTIONS.length;
Â  $("totalQTop").textContent = QUESTIONS.length;

Â  function renderQuestion() {
Â  Â  const q = QUESTIONS[idx];
Â  Â  $("qIndex").textContent = idx + 1;
Â  Â  $("questionText").textContent = q.text;

Â  Â  const container = $("options");
Â  Â  container.innerHTML = "";
Â  Â  q.options.forEach((opt, i) => {
Â  Â  Â  const label = document.createElement("label");
Â  Â  Â  label.innerHTML = `<input type="radio" name="quizOpt" value="${i}"> ${opt}`;
Â  Â  Â  container.appendChild(label);
Â  Â  });

Â  Â  $("nextBtn").disabled = true;
Â  Â  container.onchange = () => { $("nextBtn").disabled = false; };
Â  Â  resetTimer();
Â  }

Â  function resetTimer() {
Â  Â  clearInterval(timer);
Â  Â  timeLeft = TIME_LIMIT;
Â  Â  $("timeLeft").textContent = timeLeft;
Â  Â  $("progress").value = 0;

Â  Â  timer = setInterval(() => {
Â  Â  Â  timeLeft--;
Â  Â  Â  $("timeLeft").textContent = timeLeft;
Â  Â  Â  $("progress").value = TIME_LIMIT - timeLeft;
Â  Â  Â  if (timeLeft <= 0) { commitAnswer(true); nextQuestion(); }
Â  Â  }, 1000);
Â  }

Â  function commitAnswer(timedOut = false) {
Â  Â  const q = QUESTIONS[idx];
Â  Â  const radios = document.getElementsByName("quizOpt");
Â  Â  let selected = null;
Â  Â  for (const r of radios) { if (r.checked) selected = parseInt(r.value, 10); }

Â  Â  answers.push({
Â  Â  Â  id: q.id,
Â  Â  Â  selected,
Â  Â  Â  isCorrect: selected === q.correctIndex,
Â  Â  Â  timedOut
Â  Â  });
Â  }

Â  function nextQuestion() {
Â  Â  idx++;
Â  Â  if (idx >= QUESTIONS.length) {
Â  Â  Â  clearInterval(timer);
Â  Â  Â  $("quizCard").style.display = "none";
Â  Â  Â  $("finalCard").style.display = "block";
Â  Â  } else {
Â  Â  Â  renderQuestion();
Â  Â  }
Â  }

Â  $("serviceOrigin").onchange = () => {
Â  Â  $("otherServiceWrap").style.display = ($("serviceOrigin").value === "Autre") ? "block" : "none";
Â  };

Â  $("startBtn").onclick = () => {
Â  Â  const s = $("serviceOrigin").value;
Â  Â  const last = $("lastName").value.trim();
Â  Â  const first = $("firstName").value.trim();
Â  Â  const other = $("serviceOther").value.trim();

Â  Â  if (!s || !last || !first || (s === "Autre" && !other)) {
Â  Â  Â  $("startWarn").style.display = "block";
Â  Â  Â  return;
Â  Â  }
Â  Â  $("startWarn").style.display = "none";

Â  Â  resp.service = (s === "Autre") ? other : s;
Â  Â  resp.last = last;
Â  Â  resp.first = first;

Â  Â  $("startCard").style.display = "none";
Â  Â  $("quizCard").style.display = "block";
Â  Â  renderQuestion();
Â  };

Â  $("nextBtn").onclick = () => { commitAnswer(false); nextQuestion(); };
Â  $("skipBtn").onclick = () => { commitAnswer(false); nextQuestion(); };

Â  $("sendBtn").onclick = () => {
Â  Â  $("sendBtn").disabled = true;
Â  Â  $("sendStatus").textContent = "Envoi des rÃ©sultatsâ€¦";

Â  Â  const payload = {
Â  Â  Â  submittedAtISO: new Date().toISOString(),
Â  Â  Â  startedAtISO: "",
Â  Â  Â  durationSeconds: "",
Â  Â  Â  serviceOrigin: resp.service,
Â  Â  Â  lastName: resp.last,
Â  Â  Â  firstName: resp.first,
Â  Â  Â  totalQuestions: QUESTIONS.length,
Â  Â  Â  answeredCount: answers.filter(a => a.selected !== null && a.selected !== undefined).length,
Â  Â  Â  correctCount: answers.filter(a => a.isCorrect).length,
Â  Â  Â  freeText: $("freeText").value || "",
Â  Â  Â  answers: answers
Â  Â  };

Â  Â  try {
Â  Â  Â  fetch(APPS_SCRIPT_URL, {
Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  mode: "no-cors",
Â  Â  Â  Â  body: JSON.stringify(payload)
Â  Â  Â  });
Â  Â  } catch (e) {}

Â  Â  $("finalCard").style.display = "none";
Â  Â  $("doneCard").style.display = "block";

Â  Â  // ðŸ”¥ Effet fin de quiz (fort)
Â  Â  launchFlames(2600, 2.0);
Â  };
</script>
</body>
</html>
